<!DOCTYPE html>
<html>
<head>
    <title>üõ°Ô∏è CyberAI IDS</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #fff;
            min-height: 100vh;
        }
        .navbar {
            background: #16213e;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #00ff88;
        }
        .navbar h1 { color: #00ff88; font-size: 24px; }
        .status { display: flex; align-items: center; gap: 10px; }
        .status-dot {
            width: 12px; height: 12px; border-radius: 50%;
            background: #ff4444; animation: pulse 1.5s infinite;
        }
        .status-dot.active { background: #00ff88; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .container {
            max-width: 1400px; margin: 30px auto;
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 20px; padding: 0 20px;
        }
        .card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid #00ff88; border-radius: 10px;
            padding: 20px; box-shadow: 0 8px 32px rgba(0,255,136,0.1);
        }
        .card h2 { color: #00ff88; margin-bottom: 15px; font-size: 18px; }
        
        .btn {
            width: 100%; padding: 12px; margin: 5px 0;
            border: none; border-radius: 6px;
            font-weight: bold; cursor: pointer;
            font-size: 14px; transition: 0.3s;
        }
        .btn.primary { background: #00ff88; color: #000; }
        .btn.primary:hover { background: #00cc6a; }
        .btn.danger { background: #ff4444; color: #fff; }
        .btn.danger:hover { background: #cc3333; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .upload-area {
            border: 2px dashed #00ff88;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            background: rgba(0,255,136,0.05);
        }
        .upload-area:hover {
            background: rgba(0,255,136,0.15);
        }
        
        .stats-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }
        .stat-box {
            background: rgba(0,255,136,0.1);
            border: 1px solid #00ff88;
            border-radius: 6px; padding: 15px; text-align: center;
        }
        .stat-number { font-size: 32px; font-weight: bold; color: #00ff88; }
        .stat-label { font-size: 11px; color: #aaa; margin-top: 5px; }
        .stat-box.attack { border-color: #ff4444; background: rgba(255,68,68,0.1); }
        .stat-box.attack .stat-number { color: #ff4444; }
        
        .events-list {
            max-height: 400px; overflow-y: auto;
        }
        .event {
            background: rgba(0,255,136,0.05);
            border-left: 3px solid #00ff88;
            padding: 10px; margin: 8px 0; border-radius: 4px;
            display: flex; justify-content: space-between;
            align-items: center; font-size: 12px;
            animation: slideIn 0.3s ease;
        }
        .event.attack { background: rgba(255,68,68,0.1); border-left-color: #ff4444; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        
        .event-badge {
            background: #00ff88; color: #000;
            padding: 3px 8px; border-radius: 3px;
            font-weight: bold; font-size: 10px;
        }
        .event-badge.attack { background: #ff4444; color: #fff; }
        
        .progress-hidden { display: none; }
        .progress-bar {
            width: 100%; height: 8px;
            background: #333; border-radius: 10px;
            margin: 15px 0; overflow: hidden;
        }
        #progressFill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00ffff);
            width: 0%; transition: width 0.3s;
        }
        
        .full-width { grid-column: 1 / -1; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a2e; }
        ::-webkit-scrollbar-thumb { background: #00ff88; border-radius: 4px; }
        
        @media (max-width: 1024px) { .container { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>üõ°Ô∏è CyberAI IDS - CICFlowMeter</h1>
        <div class="status">
            <span>Status:</span>
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Offline</span>
        </div>
    </div>

    <div class="container">
        <div class="card">
            <h2>üî¥ Live Capture</h2>
            <button class="btn primary" id="startLiveBtn" onclick="startLive()">‚ñ∂ START LIVE</button>
            <button class="btn danger" id="stopLiveBtn" onclick="stopLive()" disabled>‚èπ STOP LIVE</button>
            <p style="margin-top: 15px; color: #aaa; font-size: 11px;">Uses CICFlowMeter for accurate feature extraction</p>
        </div>

        <div class="card">
            <h2>üìÅ Upload PCAP</h2>
            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <input type="file" id="fileInput" accept=".pcap" hidden>
                <p>Drag PCAP or click</p>
            </div>
            <div id="uploadProgress" class="progress-hidden">
                <div class="progress-bar"><div id="progressFill"></div></div>
                <p id="progressText">Processing...</p>
            </div>
        </div>

        <div class="card">
            <h2>üìä Statistics</h2>
            <div class="stats-grid">
                <div class="stat-box"><div class="stat-number" id="totalFlows">0</div><div class="stat-label">Total</div></div>
                <div class="stat-box attack"><div class="stat-number" id="attackCount">0</div><div class="stat-label">üö®</div></div>
                <div class="stat-box"><div class="stat-number" id="benignCount">0</div><div class="stat-label">‚úì</div></div>
                <div class="stat-box"><div class="stat-number" id="detectionRate">0%</div><div class="stat-label">Rate</div></div>
            </div>
        </div>

        <div class="card full-width">
            <h2>üì° Real-Time Events</h2>
            <div class="events-list" id="eventsList"></div>
        </div>
    </div>

    <script>
        const socket = io();
        let stats = { attacks: 0, benign: 0, total: 0 };

        socket.on('live_prediction', (event) => {
            if (event.prediction === 'ATTACK') stats.attacks++;
            else stats.benign++;
            stats.total++;
            updateUI();
            addEvent(event);
        });

        socket.on('capture_started', () => {
            document.getElementById('startLiveBtn').disabled = true;
            document.getElementById('stopLiveBtn').disabled = false;
            document.getElementById('statusDot').classList.add('active');
            document.getElementById('statusText').textContent = 'Capturing';
        });

        socket.on('capture_stopped', () => {
            document.getElementById('startLiveBtn').disabled = false;
            document.getElementById('stopLiveBtn').disabled = true;
            document.getElementById('statusDot').classList.remove('active');
            document.getElementById('statusText').textContent = 'Offline';
        });

        socket.on('processing_update', (data) => {
            document.getElementById('progressFill').style.width = data.progress + '%';
            document.getElementById('progressText').textContent = data.status;
        });

        socket.on('processing_complete', (data) => {
            alert(`‚úì Complete!\n${data.attacks} attacks out of ${data.total_flows} flows`);
            document.getElementById('uploadProgress').classList.add('progress-hidden');
        });

        socket.on('processing_error', (data) => {
            alert('‚úó Error: ' + data.error);
            document.getElementById('uploadProgress').classList.add('progress-hidden');
        });

        function startLive() {
            fetch('/api/start-live', { method: 'POST' })
                .then(r => r.json())
                .catch(err => alert('Error: ' + err));
        }

        function stopLive() {
            fetch('/api/stop-live', { method: 'POST' })
                .then(r => r.json())
                .catch(err => alert('Error: ' + err));
        }

        document.getElementById('fileInput').addEventListener('change', (e) => {
            if (e.target.files[0]) uploadPCAP(e.target.files[0]);
        });

        document.getElementById('uploadArea').addEventListener('dragover', (e) => {
            e.preventDefault();
            e.target.style.background = '#00ff8844';
        });

        document.getElementById('uploadArea').addEventListener('dragleave', (e) => {
            e.target.style.background = 'rgba(0,255,136,0.05)';
        });

        document.getElementById('uploadArea').addEventListener('drop', (e) => {
            e.preventDefault();
            if (e.dataTransfer.files[0]) uploadPCAP(e.dataTransfer.files[0]);
        });

        function uploadPCAP(file) {
            const form = new FormData();
            form.append('file', file);
            document.getElementById('uploadProgress').classList.remove('progress-hidden');

            fetch('/api/upload-pcap', { method: 'POST', body: form })
                .then(r => r.json())
                .catch(err => alert('Error: ' + err));
        }

        function updateUI() {
            document.getElementById('totalFlows').textContent = stats.total;
            document.getElementById('attackCount').textContent = stats.attacks;
            document.getElementById('benignCount').textContent = stats.benign;
            document.getElementById('detectionRate').textContent = 
                ((stats.attacks / Math.max(stats.total, 1) * 100) || 0).toFixed(1) + '%';
        }

        function addEvent(event) {
            const list = document.getElementById('eventsList');
            const el = document.createElement('div');
            el.className = `event ${event.prediction === 'ATTACK' ? 'attack' : ''}`;
            el.innerHTML = `
                <span class="event-badge ${event.prediction === 'ATTACK' ? 'attack' : ''}">${event.prediction}</span>
                <span>${event.source_ip}</span>
                <span>${(event.confidence * 100).toFixed(0)}%</span>
            `;
            list.insertBefore(el, list.firstChild);
            if (list.children.length > 50) list.removeChild(list.lastChild);
        }
    </script>
</body>
</html>
